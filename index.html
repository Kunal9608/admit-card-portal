<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Student & Admin Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white text-gray-800 min-h-screen flex items-center justify-center px-4 py-8">

  <!-- Login Page -->
  <div id="loginPage" class="w-full max-w-md p-8 bg-white rounded-2xl shadow-lg">
    <h2 class="text-3xl font-bold text-center text-red-700 mb-6">Login Portal</h2>
    <div class="mb-4">
      <label class="block text-gray-700 font-medium mb-1">Username</label>
      <input
        type="text"
        id="username"
        placeholder="Enter Username"
        class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-400"
      />
    </div>
    <div class="mb-6">
      <label class="block text-gray-700 font-medium mb-1">Password</label>
      <input
        type="password"
        id="password"
        placeholder="Enter Password"
        class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-400"
      />
    </div>
    <button
      onclick="login()"
      class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-2.5 rounded-lg transition duration-200"
    >
      Login
    </button>
    <p id="errorMessage" class="text-red-600 mt-4 hidden text-center font-medium">Invalid credentials</p>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="hidden w-full max-w-5xl p-6 mx-auto">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-bold text-gray-800">Dashboard</h1>
      <button
        onclick="logout()"
        class="bg-red-600 hover:bg-red-700 text-white px-5 py-2 rounded-lg font-medium"
      >
        Logout
      </button>
    </div>

    <!-- Admin Controls -->
    <div
      id="adminControls"
      class="hidden mb-8 p-6 bg-red-50 border border-red-300 rounded-xl"
    >
      <h2 class="text-xl font-bold mb-4 text-red-800">Admin Panel</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <select
          id="studentSelector"
          class="p-3 border rounded-lg bg-white text-gray-800"
        ></select>
        <input
          type="text"
          id="updateAttendance"
          placeholder="Update Attendance (%)"
          class="p-3 border rounded-lg"
        />
        <input
          type="text"
          id="updateFees"
          placeholder="Update Fee Dues"
          class="p-3 border rounded-lg"
        />
      </div>
      <button
        onclick="updateStudentData()"
        class="bg-red-600 hover:bg-red-700 text-white px-5 py-2 rounded-lg font-semibold"
      >
        Update Student Info
      </button>

      <div class="mt-6">
        <input
          type="text"
          id="newNotice"
          placeholder="Enter Notice for Students"
          class="w-full p-3 border rounded-lg mb-2"
        />
        <button
          onclick="postNotice()"
          class="bg-green-600 hover:bg-green-700 text-white px-5 py-2 rounded-lg font-semibold"
        >
          Post Notice
        </button>
      </div>

      <!-- Holiday modification -->
      <div class="mt-8">
        <h3 class="text-lg font-semibold text-red-800 mb-2">Modify Upcoming Holiday</h3>
        <input
          type="date"
          id="holidayDateInput"
          class="p-3 border rounded-lg mr-4"
        />
        <input
          type="text"
          id="holidayNameInput"
          placeholder="Holiday Name"
          class="p-3 border rounded-lg"
        />
        <button
          onclick="updateHoliday()"
          class="bg-red-600 hover:bg-red-700 text-white px-5 py-2 rounded-lg font-semibold ml-4"
        >
          Update Holiday
        </button>
      </div>
    </div>

    <!-- Student Dashboard -->
    <div id="studentDashboard" class="hidden space-y-6">
      <div class="bg-white shadow rounded-xl p-6">
        <h3 class="text-lg font-semibold text-gray-700 mb-2">Sem 4 Attendance</h3>
        <p id="attendanceDisplay" class="text-2xl font-bold text-red-700">--%</p>
        <p class="text-sm text-gray-500 mt-2">*Based on credit papers only. Contact HoD for updates.</p>
      </div>

      <div class="bg-white shadow rounded-xl p-6">
        <h3 class="text-lg font-semibold text-gray-700 mb-2">Fee Dues</h3>
        <p id="feesDisplay" class="text-xl font-bold text-red-600">--</p>
      </div>

      <div class="bg-white shadow rounded-xl p-6">
        <h3 class="text-lg font-semibold text-gray-700 mb-2">Upcoming Holidays</h3>
        <p id="upcomingHoliday" class="text-lg font-bold text-red-700"></p>
      </div>

      <div class="bg-white shadow rounded-xl p-6 text-center">
        <h3 class="text-lg font-semibold text-gray-700 mb-4">Examination Registration</h3>
        <a
          id="admitCardLink"
          href="#"
          download
          class="inline-block bg-red-600 hover:bg-red-700 text-white font-bold px-6 py-3 rounded-lg transition duration-200"
        >
          Download Admit Card
        </a>
      </div>
    </div>

    <!-- Notices Section -->
    <div class="bg-white mt-8 shadow rounded-xl p-6">
      <h3 class="text-xl font-bold mb-4 text-gray-800">Important Notices</h3>
      <ul id="notices" class="space-y-4">
        <!-- Dynamic notices go here -->
      </ul>
    </div>
  </div>

  <script>
    const users = {
      student: [
        { username: "KUNAL", password: "123" },
        { username: "AKSHAT", password: "123" },
        { username: "OM", password: "123" },
      ],
      admin: [
        { username: "ADMIN", password: "admin123" },
        { username: "ROHAN", password: "456" },
      ],
    };

    const studentData = {
      KUNAL: { attendance: "82.54", fees: "0" },
      AKSHAT: { attendance: "78.12", fees: "500" },
      OM: { attendance: "88.90", fees: "200" },
    };

    // Default holiday info, can be updated by admin
    let upcomingHoliday = {
      date: "2025-06-07",
      name: "Bakrid",
    };

    const notices = [];

    let currentUser = null;
    let currentRole = null;

    function login() {
      const username = document
        .getElementById("username")
        .value.trim()
        .toUpperCase();
      const password = document.getElementById("password").value;
      const errorMessage = document.getElementById("errorMessage");

      if (
        users.student.some(
          (u) => u.username === username && u.password === password
        )
      ) {
        currentUser = username;
        currentRole = "student";
      } else if (
        users.admin.some((u) => u.username === username && u.password === password)
      ) {
        currentUser = username;
        currentRole = "admin";
      } else {
        errorMessage.classList.remove("hidden");
        return;
      }

      document.getElementById("loginPage").classList.add("hidden");
      document.getElementById("dashboard").classList.remove("hidden");
      errorMessage.classList.add("hidden");

      document
        .getElementById("adminControls")
        .classList.toggle("hidden", currentRole !== "admin");
      document
        .getElementById("studentDashboard")
        .classList.toggle("hidden", currentRole !== "student");

      if (currentRole === "student") {
        document.getElementById("attendanceDisplay").textContent =
          studentData[currentUser].attendance + "%";
        document.getElementById("feesDisplay").textContent =
          "Rs. " + studentData[currentUser].fees;
        setAdmitCardLink(currentUser);
      }

      // Show holiday info on student dashboard
      updateHolidayDisplay();

      populateStudentSelector();
      renderNotices();

      // If admin, pre-fill holiday inputs with current holiday info
      if (currentRole === "admin") {
        document.getElementById("holidayDateInput").value = upcomingHoliday.date;
        document.getElementById("holidayNameInput").value = upcomingHoliday.name;
      }
    }

    function logout() {
      currentUser = null;
      currentRole = null;
      document.getElementById("loginPage").classList.remove("hidden");
      document.getElementById("dashboard").classList.add("hidden");
      document.getElementById("username").value = "";
      document.getElementById("password").value = "";
    }

    function setAdmitCardLink(username) {
      const baseURL =
        "https://github.com/Kunal9608/admit-card-portal/raw/main/";
      const fileName = `AdmitCard_${username}.pdf`;
      const link = document.getElementById("admitCardLink");
      link.href = baseURL + fileName;
      link.setAttribute("download", fileName);
    }

    function populateStudentSelector() {
      const selector = document.getElementById("studentSelector");
      selector.innerHTML = "";
      for (let student in studentData) {
        const opt = document.createElement("option");
        opt.value = student;
        opt.textContent = student;
        selector.appendChild(opt);
      }
    }

    function updateStudentData() {
      const student = document.getElementById("studentSelector").value;
      const attendance = document.getElementById("updateAttendance").value;
      const fees = document.getElementById("updateFees").value;

      if (attendance) studentData[student].attendance = attendance;
      if (fees) studentData[student].fees = fees;

      if (currentUser === student) {
        document.getElementById("attendanceDisplay").textContent =
          studentData[student].attendance + "%";
        document.getElementById("feesDisplay").textContent =
          "Rs. " + studentData[student].fees;
      }

      document.getElementById("updateAttendance").value = "";
      document.getElementById("updateFees").value = "";
    }

    function postNotice() {
      const newNotice = document.getElementById("newNotice").value.trim();
      if (!newNotice) return;

      const today = new Date();
      const formattedDate = today.toLocaleDateString("en-GB");

      notices.unshift({
        date: formattedDate,
        user: currentUser,
        text: newNotice,
      });

      renderNotices();
      document.getElementById("newNotice").value = "";
    }

    function renderNotices() {
      const list = document.getElementById("notices");
      list.innerHTML = "";
      notices.forEach((n) => {
        const li = document.createElement("li");
        li.className = `border-l-4 pl-4 border-red-600`;
        li.innerHTML = `
          <p class="text-sm text-gray-500">[${n.date}]</p>
          <p class="text-red-600 font-semibold">ADMIN NOTICE (${n.user}): ${n.text}</p>
        `;
        list.appendChild(li);
      });
    }

    function updateHoliday() {
      const dateInput = document.getElementById("holidayDateInput").value;
      const nameInput = document.getElementById("holidayNameInput").value.trim();

      if (!dateInput || !nameInput) {
        alert("Please enter both date and holiday name.");
        return;
      }

      upcomingHoliday.date = dateInput;
      upcomingHoliday.name = nameInput;

      updateHolidayDisplay();
      alert("Upcoming holiday updated successfully!");
    }

    function updateHolidayDisplay() {
      const holidayElement = document.getElementById("upcomingHoliday");
      if (upcomingHoliday.date && upcomingHoliday.name) {
        const dateObj = new Date(upcomingHoliday.date);
        const options = { day: "2-digit", month: "short", year: "numeric" };
        const formattedDate = dateObj.toLocaleDateString("en-GB", options);
        holidayElement.textContent = `${formattedDate} - ${upcomingHoliday.name}`;
      } else {
        holidayElement.textContent = "No upcoming holidays.";
      }
    }
  </script>
</body>
</html>
